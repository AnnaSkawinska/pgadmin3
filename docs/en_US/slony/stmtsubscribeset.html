<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1">
<title>SUBSCRIBE SET</title>
<link rel="stylesheet" href="stylesheet.css" type="text/css">
<link rev="made" href="pgsql-docs@postgresql.org">
<meta name="generator" content="DocBook XSL Stylesheets V1.70.0">
<link rel="start" href="index.html" title="Slony-I HEAD_20051214 Documentation">
<link rel="up" href="cmds.html" title="Configuration and Action commmands">
<link rel="prev" href="stmtdroptrigger.html" title="DROP TRIGGER">
<link rel="next" href="stmtunsubscribeset.html" title="UNSUBSCRIBE SET">
<link rel="copyright" href="ln-legalnotice.html" title="Legal Notice">
</head>
<body bgcolor="white" text="black" link="#0000FF" vlink="#840084" alink="#0000FF"><div class="refentry" lang="en">
<a name="stmtsubscribeset"></a><div class="titlepage"></div>
<div class="refnamediv">
<h2>Name</h2>
<p>SUBSCRIBE SET &#8212;  Start replication of <span class="productname">Slony-I</span> set </p>
</div>
<div class="refsynopsisdiv">
<h2>Synopsis</h2>
<div class="cmdsynopsis"><p><code class="command">SUBSCRIBE SET (options);</code></p></div>
</div>
<div class="refsect1" lang="en">
<a name="id593044"></a><h2>Description</h2>
<p> Causes a node (subscriber) to start replicating a set of
    tables either from the origin or from another provider node, which
    must itself already be be an active, forwarding subscriber.</p>
<p> The application tables contained in the set must already
     exist and should ideally be empty. The current version of
     <span class="productname">Slony-I</span> will <span class="emphasis"><em>not</em></span>
     attempt to copy the schema of the set. The replication daemon will
     start copying the current content of the set from the given
     provider and then try to catch up with any update activity that
     happened during that copy process. After successful subscription,
     the tables are guarded on the subscriber, using triggers, against
     accidental updates by the application.
    </p>
<p> If the tables on the subscriber are <span class="emphasis"><em>not</em></span> empty, then
     the <code class="command">COPY SET</code> process winds up doing more work than should be
     strictly necessary:
     </p>
<div class="itemizedlist"><ul type="disc">
<li><p> It deletes all &#8220;<span class="quote">old</span>&#8221; entries in
      the table</p></li>
<li><p> Those old entries
	clutter up the table until it is next
	<code class="command">VACUUM</code>ed <span class="emphasis"><em>after</em></span> the
	subscription process is complete</p></li>
<li><p> The indices for the table will contain entries
	for the old, deleted entries, which will slow the process of
	inserting new entries into the index.</p></li>
</ul></div>
<p>

     </p>
<div class="warning" style="margin-left: 0.5in; margin-right: 0.5in;">
<h3 class="title">Warning</h3>
<p> This operation can take a (potentially distinctly)
     non-zero period of time.  If you have a great deal of data in a
     particular set of tables, it may take hours or even (if &#8220;<span class="quote">a
     great deal</span>&#8221; indicates &#8220;<span class="quote">tens or hundreds gigabytes of
     data</span>&#8221;) possibly multiple days for this event to
     complete.</p>
<p> The <code class="command">SUBSCRIBE SET</code> request will,
     nonetheless, return fairly much immediately, even though the work
     is merely &#8220;<span class="quote">in progress.</span>&#8221; If you need to set up
     subscriptions for a set of cascading nodes, you will need to wait
     for each subscriber to complete subscribing before submitting
     requests for subscriptions that use that node as a provider.  If
     you don't, it won't be a big deal: <code class="command">slonik</code> will
     check the node, discover that it is not yet an active provider
     for the set, and report back:</p>
<pre class="programlisting"> Slony-I: provider 2 is not an active forwarding node for replication set 1</pre>
<p> In effect, such subscription requests will be ignored
     until the provider is ready.</p>
</div>
<p>

     </p>
<div class="note" style="margin-left: 0.5in; margin-right: 0.5in;">
<h3 class="title">Note</h3>
<p> If you need to revise subscription information for a
       node, you <span class="emphasis"><em>also</em></span> submit the new information
       using this command, and the new configuration will be propagated
       throughout the replication network.  The normal reason to revise
       this information is that you want a node to subscribe to a
       <span class="emphasis"><em> different </em></span> provider node, or for a node to
       become a &#8220;<span class="quote">forwarding</span>&#8221; subscriber so it may later
       become the provider for a later subscriber.</p>
</div>
<p>

     </p>
<div class="variablelist"><dl>
<dt><span class="term"><code class="literal"> ID = ival </code></span></dt>
<dd><p> ID of the set to subscribe</p></dd>
<dt><span class="term"><code class="literal"> PROVIDER = ival </code></span></dt>
<dd><p> Node ID of the data provider from which this
       node draws data.</p></dd>
<dt><span class="term"><code class="literal"> RECEIVER = ival </code></span></dt>
<dd><p> Node ID of the new subscriber</p></dd>
<dt><span class="term"><code class="literal"> FORWARD = boolean </code></span></dt>
<dd><p> Flag whether or not the new subscriber should
	 store the log information during replication to make it
	 possible candidate for the provider role for future
	 nodes.</p></dd>
</dl></div>
<p>
    </p>
<p> This uses <a href="function.subscribeset-integer-integer-integer-boolean.html">schemadocsubscribeset( integer, integer, integer, boolean )</a>. </p>
</div>
<div class="refsect1" lang="en">
<a name="id593269"></a><h2>Example</h2>
<pre class="programlisting">SUBSCRIBE SET (
   ID = 1,
   PROVIDER = 1,
   RECEIVER = 3,
   FORWARD = YES
);
    </pre>
</div>
<div class="refsect1" lang="en">
<a name="id593280"></a><h2> Locking Behaviour </h2>
<p> This operation does <span class="emphasis"><em>not</em></span> require
    acquiring any locks on the provider node.</p>
<p> On the subscriber node, it will have the effect of locking
    every table in the replication set.  In version 1.2, exclusive
    locks are acquired at the beginning of the process; in earlier
    versions, locks were acquired implicitly as activity mandated it,
    which left some risk of deadlock if other applications could
    access the subscriber database at this time.
    </p>
</div>
<div class="refsect1" lang="en">
<a name="id593299"></a><h2> Version Information </h2>
<p> This command was introduced in <span class="productname">Slony-I</span> 1.0 </p>
</div>
</div></body>
</html>
