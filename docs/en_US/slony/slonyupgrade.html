<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1">
<title>20.  Slony-I Upgrade</title>
<link rel="stylesheet" href="stylesheet.css" type="text/css">
<link rev="made" href="pgsql-docs@postgresql.org">
<meta name="generator" content="DocBook XSL Stylesheets V1.71.0">
<link rel="start" href="index.html" title="Slony-I HEAD_20060922 Documentation">
<link rel="up" href="slonyadmin.html" title="Slony-I Administration">
<link rel="prev" href="altperl.html" title="19. Slony-I Administration Scripts">
<link rel="next" href="versionupgrade.html" title="21. Using Slony-I for PostgreSQL Upgrades">
<link rel="copyright" href="ln-legalnotice.html" title="Legal Notice">
</head>
<body bgcolor="white" text="black" link="#0000FF" vlink="#840084" alink="#0000FF"><div class="sect1" lang="en">
<div class="titlepage"><div><div><h2 class="title" style="clear: both">
<a name="slonyupgrade"></a>20.  <span class="productname">Slony-I</span> Upgrade </h2></div></div></div>
<a name="id2562337"></a><p> When upgrading <span class="productname">Slony-I</span>, the installation on all nodes in a
cluster must be upgraded at once, using the <a href="slonik.html" title="slonik"><span class="refentrytitle"><a name="app-slonik-title"></a><span class="application">slonik</span></span></a>
command <a href="stmtupdatefunctions.html" title="UPDATE FUNCTIONS"><span class="refentrytitle">UPDATE FUNCTIONS</span></a>.</p>
<p> While this requires temporarily stopping replication, it does
not forcibly require an outage for applications that submit
updates. </p>
<p>The proper upgrade procedure is thus:</p>
<div class="itemizedlist"><ul type="disc">
<li><p> Stop the <a href="slon.html" title="slon"><span class="refentrytitle"><a name="app-slon-title"></a><span class="application">slon</span></span></a> processes on all nodes.
(<span class="emphasis"><em>e.g.</em></span> - old version of <a href="slon.html" title="slon"><span class="refentrytitle"><a name="app-slon-title"></a><span class="application">slon</span></span></a>)</p></li>
<li><p> Install the new version of <a href="slon.html" title="slon"><span class="refentrytitle"><a name="app-slon-title"></a><span class="application">slon</span></span></a> software on all
nodes.</p></li>
<li><p> Execute a <a href="slonik.html" title="slonik"><span class="refentrytitle"><a name="app-slonik-title"></a><span class="application">slonik</span></span></a> script containing the
command <code class="command">update functions (id = [whatever]);</code> for
each node in the cluster.</p></li>
<li><p> Start all slons.  </p></li>
</ul></div>
<p> The trickiest part of this is ensuring that the C library
containing SPI functions is copied into place in the <span class="productname">PostgreSQL</span> build;
the easiest and safest way to handle this is to have two separate
<span class="productname">PostgreSQL</span> builds, one for each <span class="productname">Slony-I</span> version, where the postmaster
is shut down and then restarted against the &#8220;<span class="quote">new</span>&#8221; build;
that approach requires a brief database outage on each node.</p>
<p> While that approach has been found to be easier and safer,
nothing prevents one from carefully copying <span class="productname">Slony-I</span> components for
the new version into place to overwrite the old version as
the &#8220;<span class="quote">install</span>&#8221; step.  That might <span class="emphasis"><em>not</em></span>
work on <span class="trademark">Windows</span>&#8482; if it locks library files that
are in use.</p>
</div></body>
</html>
