<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1">
<title>Chapter 25. Write-Ahead Logging (WAL)</title>
<link rel="stylesheet" href="stylesheet.css" type="text/css">
<link rev="made" href="pgsql-docs@postgresql.org">
<meta name="generator" content="DocBook XSL Stylesheets V1.73.2">
<link rel="start" href="index.html" title="PostgreSQL 8.0.15 Documentation">
<link rel="up" href="admin.html" title="Part III. Server Administration">
<link rel="prev" href="disk-full.html" title="24.2. Disk Full Failure">
<link rel="next" href="wal-configuration.html" title="25.2. WAL Configuration">
<link rel="copyright" href="ln-legalnotice.html" title="Legal Notice">
</head>
<body bgcolor="white" text="black" link="#0000FF" vlink="#840084" alink="#0000FF"><div class="chapter" lang="en" id="wal">
<div class="titlepage"><div><div><h2 class="title">Chapter 25. Write-Ahead Logging (<acronym class="acronym">WAL</acronym>)</h2></div></div></div>
<div class="toc">
<p><b>Table of Contents</b></p>
<dl>
<dt><span class="sect1"><a href="wal.html#wal-benefits">25.1. Benefits of <acronym class="acronym">WAL</acronym></a></span></dt>
<dt><span class="sect1"><a href="wal-configuration.html">25.2. <acronym class="acronym">WAL</acronym> Configuration</a></span></dt>
<dt><span class="sect1"><a href="wal-internals.html">25.3. Internals</a></span></dt>
</dl>
</div>
<a name="id2670188"></a><a name="id2670197"></a><p>   <em class="firstterm">Write-Ahead Logging</em> (<acronym class="acronym">WAL</acronym>)
   is a standard approach to transaction logging.  Its detailed
   description may be found in most (if not all) books about
   transaction processing. Briefly, <acronym class="acronym">WAL</acronym>'s central
   concept is that changes to data files (where tables and indexes
   reside) must be written only after those changes have been logged,
   that is, when log records describing the changes have been flushed
   to permanent storage. If we follow this procedure, we do not need
   to flush data pages to disk on every transaction commit, because we
   know that in the event of a crash we will be able to recover the
   database using the log: any changes that have not been applied to
   the data pages can be redone from the log records.  (This is
   roll-forward recovery, also known as REDO.)
  </p>
<div class="sect1" lang="en">
<div class="titlepage"><div><div><h2 class="title" style="clear: both" id="wal-benefits">25.1. Benefits of <acronym class="acronym">WAL</acronym></h2></div></div></div>
<a name="id2670240"></a><p>    The first major benefit of using <acronym class="acronym">WAL</acronym> is a
    significantly reduced number of disk writes, because only the log
    file needs to be flushed to disk at the time of transaction
    commit, rather than every data file changed by the transaction.
    In multiuser environments, commits of many transactions
    may be accomplished with a single <code class="function">fsync</code> of
    the log file. Furthermore, the log file is written sequentially,
    and so the cost of syncing the log is much less than the cost of
    flushing the data pages.   This is especially true for servers
    handling many small transactions touching different parts of the data
    store.
   </p>
<p>    The next benefit is consistency of the data pages. The truth is
    that, before <acronym class="acronym">WAL</acronym>,
    <span class="productname">PostgreSQL</span> was never able to guarantee
    consistency in the case of a crash.  Before
    <acronym class="acronym">WAL</acronym>, any crash during writing could result in:

    </p>
<div class="orderedlist"><ol type="1">
<li>index rows pointing to nonexistent table rows</li>
<li>index rows lost in split operations</li>
<li>totally corrupted table or index page content, because
      of partially written data pages</li>
</ol></div>
<p>

    Problems with indexes (problems 1 and 2) could possibly have been
    fixed by additional <code class="function">fsync</code> calls, but it is
    not obvious how to handle the last case without
    <acronym class="acronym">WAL</acronym>.  <acronym class="acronym">WAL</acronym> saves the entire data
    page content in the log if that is required to ensure page
    consistency for after-crash recovery.
   </p>
<p>    Finally, <acronym class="acronym">WAL</acronym> makes it possible to support on-line
    backup and point-in-time recovery, as described in <a class="xref" href="backup-online.html" title="22.3. On-line backup and point-in-time recovery (PITR)">Section 22.3, &#8220;On-line backup and point-in-time recovery (PITR)&#8221;</a>.  By archiving the WAL data we can support
    reverting to any time instant covered by the available WAL data:
    we simply install a prior physical backup of the database, and
    replay the WAL log just as far as the desired time.  What's more,
    the physical backup doesn't have to be an instantaneous snapshot
    of the database state [mdash ] if it is made over some period of time,
    then replaying the WAL log for that period will fix any internal
    inconsistencies.
   </p>
</div>
</div></body>
</html>
