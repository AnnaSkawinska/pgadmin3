<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1">
<title>9.12. Sequence Manipulation Functions</title>
<link rel="stylesheet" href="stylesheet.css" type="text/css">
<link rev="made" href="pgsql-docs@postgresql.org">
<meta name="generator" content="DocBook XSL Stylesheets V1.64.1">
<link rel="home" href="index.html" title="PostgreSQL 8.1devel Documentation">
<link rel="up" href="functions.html" title="Chapter 9. Functions and Operators">
<link rel="previous" href="functions-net.html" title="9.11. Network Address Functions and Operators">
<link rel="next" href="functions-conditional.html" title="9.13. Conditional Expressions">
</head>
<body bgcolor="white" text="black" link="#0000FF" vlink="#840084" alink="#0000FF"><div class="sect1" lang="en">
<div class="titlepage">
<div><div><h2 class="title" style="clear: both">
<a name="functions-sequence"></a>9.12. Sequence Manipulation Functions</h2></div></div>
<div></div>
</div>
<a name="id2560090"></a><a name="id2560095"></a><a name="id2560101"></a><a name="id2560107"></a><p>   This section describes <span class="productname">PostgreSQL</span>'s functions
   for operating on <i class="firstterm">sequence objects</i>.
   Sequence objects (also called sequence generators or
   just sequences) are special single-row tables created with
   <tt class="command">CREATE SEQUENCE</tt>.  A sequence object is usually used to
   generate unique identifiers for rows of a table.  The sequence functions,
   listed in <a href="functions-sequence.html#functions-sequence-table" title="Table 9.34. Sequence Functions">Table 9.34, &#8220;Sequence Functions&#8221;</a>,
   provide simple, multiuser-safe methods for obtaining successive
   sequence values from sequence objects.
  </p>
<div class="table">
<a name="functions-sequence-table"></a><p class="title"><b>Table 9.34. Sequence Functions</b></p>
<table summary="Sequence Functions" border="1">
<colgroup>
<col>
<col>
<col>
</colgroup>
<thead><tr>
<th>Function</th>
<th>Return Type</th>
<th>Description</th>
</tr></thead>
<tbody>
<tr>
<td><tt class="literal"><tt class="function">nextval</tt>(<tt class="type">text</tt>)</tt></td>
<td><tt class="type">bigint</tt></td>
<td>Advance sequence and return new value</td>
</tr>
<tr>
<td><tt class="literal"><tt class="function">currval</tt>(<tt class="type">text</tt>)</tt></td>
<td><tt class="type">bigint</tt></td>
<td>Return value most recently obtained with <tt class="function">nextval</tt>
</td>
</tr>
<tr>
<td><tt class="literal"><tt class="function">setval</tt>(<tt class="type">text</tt>, <tt class="type">bigint</tt>)</tt></td>
<td><tt class="type">bigint</tt></td>
<td>Set sequence's current value</td>
</tr>
<tr>
<td><tt class="literal"><tt class="function">setval</tt>(<tt class="type">text</tt>, <tt class="type">bigint</tt>, <tt class="type">boolean</tt>)</tt></td>
<td><tt class="type">bigint</tt></td>
<td>Set sequence's current value and <tt class="literal">is_called</tt> flag</td>
</tr>
</tbody>
</table>
</div>
<p>   For largely historical reasons, the sequence to be operated on by a
   sequence-function call is specified by a text-string argument.  To
   achieve some compatibility with the handling of ordinary
   <span class="acronym">SQL</span> names, the sequence functions convert their
   argument to lowercase unless the string is double-quoted.  Thus
</p>
<pre class="programlisting">nextval('foo')      <i class="lineannotation"><span class="lineannotation">operates on sequence <tt class="literal">foo</tt></span></i>
nextval('FOO')      <i class="lineannotation"><span class="lineannotation">operates on sequence <tt class="literal">foo</tt></span></i>
nextval('"Foo"')    <i class="lineannotation"><span class="lineannotation">operates on sequence <tt class="literal">Foo</tt></span></i></pre>
<p>
   The sequence name can be schema-qualified if necessary:
</p>
<pre class="programlisting">nextval('myschema.foo')     <i class="lineannotation"><span class="lineannotation">operates on <tt class="literal">myschema.foo</tt></span></i>
nextval('"myschema".foo')   <i class="lineannotation"><span class="lineannotation">same as above</span></i>
nextval('foo')              <i class="lineannotation"><span class="lineannotation">searches search path for <tt class="literal">foo</tt></span></i></pre>
<p>
   Of course, the text argument can be the result of an expression,
   not only a simple literal, which is occasionally useful.
  </p>
<p>   The available sequence functions are:

    </p>
<div class="variablelist"><dl>
<dt><span class="term"><tt class="function">nextval</tt></span></dt>
<dd><p>        Advance the sequence object to its next value and return that
        value.  This is done atomically: even if multiple sessions
        execute <tt class="function">nextval</tt> concurrently, each will safely receive
        a distinct sequence value.
       </p></dd>
<dt><span class="term"><tt class="function">currval</tt></span></dt>
<dd><p>        Return the value most recently obtained by <tt class="function">nextval</tt>
        for this sequence in the current session.  (An error is
        reported if <tt class="function">nextval</tt> has never been called for this
        sequence in this session.)  Notice that because this is returning
        a session-local value, it gives a predictable answer whether or not
        other sessions have executed <tt class="function">nextval</tt> since the
        current session did.
       </p></dd>
<dt><span class="term"><tt class="function">setval</tt></span></dt>
<dd>
<p>        Reset the sequence object's counter value.  The two-parameter
        form sets the sequence's <tt class="literal">last_value</tt> field to the specified
        value and sets its <tt class="literal">is_called</tt> field to <tt class="literal">true</tt>,
        meaning that the next <tt class="function">nextval</tt> will advance the sequence
        before returning a value.  In the three-parameter form,
        <tt class="literal">is_called</tt> may be set either <tt class="literal">true</tt> or
        <tt class="literal">false</tt>.  If it's set to <tt class="literal">false</tt>,
        the next <tt class="function">nextval</tt> will return exactly the specified
        value, and sequence advancement commences with the following
        <tt class="function">nextval</tt>.  For example,

</p>
<pre class="screen">SELECT setval('foo', 42);           <i class="lineannotation"><span class="lineannotation">Next <tt class="function">nextval</tt> will return 43</span></i>
SELECT setval('foo', 42, true);     <i class="lineannotation"><span class="lineannotation">Same as above</span></i>
SELECT setval('foo', 42, false);    <i class="lineannotation"><span class="lineannotation">Next <tt class="function">nextval</tt> will return 42</span></i></pre>
<p>

        The result returned by <tt class="function">setval</tt> is just the value of its
        second argument.
       </p>
</dd>
</dl></div>
<p>
  </p>
<div class="important" style="margin-left: 0.5in; margin-right: 0.5in;">
<h3 class="title">Important</h3>
<p>    To avoid blocking of concurrent transactions that obtain numbers from the
    same sequence, a <tt class="function">nextval</tt> operation is never rolled back;
    that is, once a value has been fetched it is considered used, even if the
    transaction that did the <tt class="function">nextval</tt> later aborts.  This means
    that aborted transactions may leave unused &#8220;<span class="quote">holes</span>&#8221; in the
    sequence of assigned values.  <tt class="function">setval</tt> operations are never
    rolled back, either.
   </p>
</div>
<p>   If a sequence object has been created with default parameters,
   <tt class="function">nextval</tt> calls on it will return successive values
   beginning with 1.  Other behaviors can be obtained by using
   special parameters in the <a href="sql-createsequence.html" title="CREATE SEQUENCE"><span class="refentrytitle"><a name="sql-createsequence-title"></a>CREATE SEQUENCE</span></a> command;
   see its command reference page for more information.
  </p>
</div></body>
</html>
