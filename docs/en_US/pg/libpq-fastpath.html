<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1">
<title>27.6. The Fast-Path Interface</title>
<link rel="stylesheet" href="stylesheet.css" type="text/css">
<link rev="made" href="pgsql-docs@postgresql.org">
<meta name="generator" content="DocBook XSL Stylesheets V1.64.1">
<link rel="home" href="index.html" title="PostgreSQL 8.1devel Documentation">
<link rel="up" href="libpq.html" title="Chapter 27. libpq - C Library">
<link rel="previous" href="libpq-cancel.html" title="27.5. Cancelling Queries in Progress">
<link rel="next" href="libpq-notify.html" title="27.7. Asynchronous Notification">
</head>
<body bgcolor="white" text="black" link="#0000FF" vlink="#840084" alink="#0000FF"><div class="sect1" lang="en">
<div class="titlepage">
<div><div><h2 class="title" style="clear: both">
<a name="libpq-fastpath"></a>27.6. The Fast-Path Interface</h2></div></div>
<div></div>
</div>
<a name="id2613440"></a><p><span class="productname">PostgreSQL</span> provides a fast-path interface to send
simple function calls to the server.</p>
<div class="tip" style="margin-left: 0.5in; margin-right: 0.5in;">
<h3 class="title">Tip</h3>
<p>This interface is somewhat obsolete, as one may achieve similar performance
and greater functionality by setting up a prepared statement to define the
function call.  Then, executing the statement with binary transmission of
parameters and results substitutes for a fast-path function call.</p>
</div>
<p>The function <tt class="function">PQfn</tt><a name="id2613474"></a>
requests execution of a server function via the fast-path interface:
</p>
<pre class="synopsis">PGresult *PQfn(PGconn *conn,
               int fnid,
               int *result_buf,
               int *result_len,
               int result_is_int,
               const PQArgBlock *args,
               int nargs);

typedef struct {
    int len;
    int isint;
    union {
        int *ptr;
        int integer;
    } u;
} PQArgBlock;</pre>
<p>     The <i class="parameter"><tt>fnid</tt></i> argument is the OID of the function to be
     executed.  <i class="parameter"><tt>args</tt></i> and <i class="parameter"><tt>nargs</tt></i> define the
     parameters to be passed to the function; they must match the declared
     function argument list.  When the <i class="parameter"><tt>isint</tt></i> field of a
     parameter
     structure is true,
     the <i class="parameter"><tt>u.integer</tt></i> value is sent to the server as an integer
     of the indicated length (this must be 1, 2, or 4 bytes); proper
     byte-swapping occurs.  When <i class="parameter"><tt>isint</tt></i> is false, the
     indicated number of bytes at <i class="parameter"><tt>*u.ptr</tt></i> are sent with no
     processing; the data must be in the format expected by the server for
     binary transmission of the function's argument data type.
     <i class="parameter"><tt>result_buf</tt></i> is the buffer in which
     to place the return value.  The caller must  have  allocated
     sufficient space to store the return value.  (There is no check!)
     The actual result length will be returned in the integer pointed
     to  by  <i class="parameter"><tt>result_len</tt></i>.
     If a 1, 2, or 4-byte integer result is expected, set
     <i class="parameter"><tt>result_is_int</tt></i> to 1, otherwise set it to 0.
     Setting <i class="parameter"><tt>result_is_int</tt></i> to 1
     causes <span class="application">libpq</span> to byte-swap the value if necessary, so that
     it is
     delivered as a proper <tt class="type">int</tt> value for the client machine.  When
     <i class="parameter"><tt>result_is_int</tt></i> is 0, the binary-format byte string sent by
     the server is returned unmodified.</p>
<p><tt class="function">PQfn</tt> always returns a valid <tt class="structname">PGresult</tt> pointer. The result status
should be checked before the result is used.   The
caller is responsible for  freeing  the  <tt class="structname">PGresult</tt>  with
<tt class="function">PQclear</tt> when it is no longer needed.</p>
<p>Note that it is not possible to handle null arguments, null results, nor
set-valued results when using this interface.</p>
</div></body>
</html>
