<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1">
<title>41.33. pg_locks</title>
<link rel="stylesheet" href="stylesheet.css" type="text/css">
<link rev="made" href="pgsql-docs@postgresql.org">
<meta name="generator" content="DocBook XSL Stylesheets V1.64.1">
<link rel="home" href="index.html" title="PostgreSQL 8.1devel Documentation">
<link rel="up" href="catalogs.html" title="Chapter 41. System Catalogs">
<link rel="previous" href="view-pg-indexes.html" title="41.32. pg_indexes">
<link rel="next" href="view-pg-rules.html" title="41.34. pg_rules">
</head>
<body bgcolor="white" text="black" link="#0000FF" vlink="#840084" alink="#0000FF"><div class="sect1" lang="en">
<div class="titlepage">
<div><div><h2 class="title" style="clear: both">
<a name="view-pg-locks"></a>41.33. <tt class="structname">pg_locks</tt></h2></div></div>
<div></div>
</div>
<a name="id2734679"></a><p>   The view <tt class="structname">pg_locks</tt> provides access to
   information about the locks held by open transactions within the
   database server.  See <a href="mvcc.html" title="Chapter 12. Concurrency Control">Chapter 12, <i>Concurrency Control</i></a> for more discussion
   of locking.
  </p>
<p>   <tt class="structname">pg_locks</tt> contains one row per active lockable
   object, requested lock mode, and relevant transaction.  Thus, the same
   lockable object may
   appear many times, if multiple transactions are holding or waiting
   for locks on it.  However, an object that currently has no locks on it
   will not appear at all.  A lockable object is either a relation (e.g., a
   table) or a transaction ID.
  </p>
<p>   Note that this view includes only table-level
   locks, not row-level ones.  If a transaction is waiting for a
   row-level lock, it will appear in the view as waiting for the
   transaction ID of the current holder of that row lock.
  </p>
<div class="table">
<a name="id2734720"></a><p class="title"><b>Table 41.33. <tt class="structname">pg_locks</tt> Columns</b></p>
<table summary="pg_locks Columns" border="1">
<colgroup>
<col>
<col>
<col>
<col>
</colgroup>
<thead><tr>
<th>Name</th>
<th>Type</th>
<th>References</th>
<th>Description</th>
</tr></thead>
<tbody>
<tr>
<td><tt class="structfield">relation</tt></td>
<td><tt class="type">oid</tt></td>
<td><tt class="literal"><a href="catalog-pg-class.html" title="41.9. pg_class"><tt class="structname">pg_class</tt></a>.oid</tt></td>
<td>       OID of the locked relation, or NULL if the lockable object
       is a transaction ID
      </td>
</tr>
<tr>
<td><tt class="structfield">database</tt></td>
<td><tt class="type">oid</tt></td>
<td><tt class="literal"><a href="catalog-pg-database.html" title="41.12. pg_database"><tt class="structname">pg_database</tt></a>.oid</tt></td>
<td>       OID of the database in which the locked relation exists, or
       zero if the locked relation is a globally-shared table, or
       NULL if the lockable object is a transaction ID
      </td>
</tr>
<tr>
<td><tt class="structfield">transaction</tt></td>
<td><tt class="type">xid</tt></td>
<td> </td>
<td>       ID of a transaction, or NULL if the lockable object is a relation
      </td>
</tr>
<tr>
<td><tt class="structfield">pid</tt></td>
<td><tt class="type">integer</tt></td>
<td> </td>
<td>process ID of a server process holding or awaiting this
      lock</td>
</tr>
<tr>
<td><tt class="structfield">mode</tt></td>
<td><tt class="type">text</tt></td>
<td> </td>
<td>name of the lock mode held or desired by this process (see <a href="explicit-locking.html#locking-tables" title="12.3.1. Table-Level Locks">Section 12.3.1, &#8220;Table-Level Locks&#8221;</a>)</td>
</tr>
<tr>
<td><tt class="structfield">granted</tt></td>
<td><tt class="type">boolean</tt></td>
<td> </td>
<td>true if lock is held, false if lock is awaited</td>
</tr>
</tbody>
</table>
</div>
<p>   <tt class="structfield">granted</tt> is true in a row representing a lock
   held by the indicated session.  False indicates that this session is
   currently waiting to acquire this lock, which implies that some other
   session is holding a conflicting lock mode on the same lockable object.
   The waiting session will sleep until the other lock is released (or a
   deadlock situation is detected). A single session can be waiting to acquire
   at most one lock at a time.
  </p>
<p>   Every transaction holds an exclusive lock on its transaction ID for its
   entire duration. If one transaction finds it necessary to wait specifically
   for another transaction, it does so by attempting to acquire share lock on
   the other transaction ID. That will succeed only when the other transaction
   terminates and releases its locks. 
  </p>
<p>   When the <tt class="structname">pg_locks</tt> view is accessed, the
   internal lock manager data structures are momentarily locked, and
   a copy is made for the view to display.  This ensures that the
   view produces a consistent set of results, while not blocking
   normal lock manager operations longer than necessary.  Nonetheless
   there could be some impact on database performance if this view is
   read often.
  </p>
<p>   <tt class="structname">pg_locks</tt> provides a global view of all locks
   in the database cluster, not only those relevant to the current database.
   Although its <tt class="structfield">relation</tt> column can be joined
   against <tt class="structname">pg_class</tt>.<tt class="structfield">oid</tt> to identify locked
   relations, this will only work correctly for relations in the current
   database (those for which the <tt class="structfield">database</tt> column
   is either the current database's OID or zero).
  </p>
<p>   If you have enabled the statistics collector, the
   <tt class="structfield">pid</tt> column can be joined to the
   <tt class="structfield">procpid</tt> column of the
   <tt class="structname">pg_stat_activity</tt> view to get more
   information on the session holding or waiting to hold the lock.
  </p>
</div></body>
</html>
