<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1">
<title>27.5. Cancelling Queries in Progress</title>
<link rel="stylesheet" href="stylesheet.css" type="text/css">
<link rev="made" href="pgsql-docs@postgresql.org">
<meta name="generator" content="DocBook XSL Stylesheets V1.64.1">
<link rel="home" href="index.html" title="PostgreSQL 8.1devel Documentation">
<link rel="up" href="libpq.html" title="Chapter 27. libpq - C Library">
<link rel="previous" href="libpq-async.html" title="27.4. Asynchronous Command Processing">
<link rel="next" href="libpq-fastpath.html" title="27.6. The Fast-Path Interface">
</head>
<body bgcolor="white" text="black" link="#0000FF" vlink="#840084" alink="#0000FF"><div class="sect1" lang="en">
<div class="titlepage">
<div><div><h2 class="title" style="clear: both">
<a name="libpq-cancel"></a>27.5. Cancelling Queries in Progress</h2></div></div>
<div></div>
</div>
<a name="id2613158"></a><p>A client application can request cancellation of
a command that is still being processed by the
server, using the functions described in this section.

</p>
<div class="variablelist"><dl>
<dt><span class="term"><tt class="function">PQgetCancel</tt><a name="id2613182"></a></span></dt>
<dd>
<p>          Creates a data structure containing the information needed to cancel
          a command issued through a particular database connection.
</p>
<pre class="synopsis">PGcancel *PQgetCancel(PGconn *conn);</pre>
<p><tt class="function">PQgetCancel</tt> creates a 
<tt class="structname">PGcancel</tt><a name="id2613208"></a> object given
a <tt class="structname">PGconn</tt> connection object.  It will return NULL if the
given <i class="parameter"><tt>conn</tt></i> is NULL or an invalid connection.  The
<tt class="structname">PGcancel</tt> object is an opaque structure that is not meant
to be accessed directly by the application; it can only be passed to
<tt class="function">PQcancel</tt> or <tt class="function">PQfreeCancel</tt>.</p>
</dd>
<dt><span class="term"><tt class="function">PQfreeCancel</tt><a name="id2613251"></a></span></dt>
<dd>
<p>          Frees a data structure created by <tt class="function">PQgetCancel</tt>.
</p>
<pre class="synopsis">void PQfreeCancel(PGcancel *cancel);</pre>
<p><tt class="function">PQfreeCancel</tt> frees a data object previously created
by <tt class="function">PQgetCancel</tt>.</p>
</dd>
<dt><span class="term"><tt class="function">PQcancel</tt><a name="id2613292"></a></span></dt>
<dd>
<p>          Requests that the server abandon
          processing of the current command.
</p>
<pre class="synopsis">int PQcancel(PGcancel *cancel, char *errbuf, int errbufsize);</pre>
<p>The return value is 1 if the cancel request was successfully
dispatched and 0 if not.  If not, <i class="parameter"><tt>errbuf</tt></i> is filled with an error
message explaining why not.  <i class="parameter"><tt>errbuf</tt></i> must be a char array of size
<i class="parameter"><tt>errbufsize</tt></i> (the recommended size is 256 bytes).</p>
<p>Successful dispatch is no guarantee that the request will have any effect,
however.  If the cancellation is effective, the current command will terminate
early and return an error result.  If the cancellation fails (say, because the
server was already done processing the command), then there will be no visible
result at all.</p>
<p><tt class="function">PQcancel</tt> can safely be invoked from a signal handler,
if the <i class="parameter"><tt>errbuf</tt></i> is a local variable in the signal handler.  The
<tt class="structname">PGcancel</tt> object is read-only as far as
<tt class="function">PQcancel</tt> is concerned, so it can also be invoked from a
thread that is separate from the one manipulating the <tt class="structname">PGconn</tt>
object.</p>
</dd>
</dl></div>
<p>

</p>
<div class="variablelist"><dl>
<dt><span class="term"><tt class="function">PQrequestCancel</tt><a name="id2613379"></a></span></dt>
<dd>
<p>          Requests that the server abandon
          processing of the current command.
</p>
<pre class="synopsis">int PQrequestCancel(PGconn *conn);</pre>
<p><tt class="function">PQrequestCancel</tt> is a deprecated variant of
<tt class="function">PQcancel</tt>.  It operates directly on the
<tt class="structname">PGconn</tt> object, and in case of failure stores the
error message in the <tt class="structname">PGconn</tt> object (whence it can be
retrieved by <tt class="function">PQerrorMessage</tt>).  Although the
functionality is the same, this approach creates hazards for multiple-thread
programs and signal handlers, since it is possible that overwriting the
<tt class="structname">PGconn</tt>'s error message will mess up the operation currently
in progress on the connection.</p>
</dd>
</dl></div>
</div></body>
</html>
